---
diff: 提高+/省选-
pid: P9590
name: 「PFLOI R1」PFL 团主的 PFL 操作
tag: ['动态规划,dp', '洛谷原创', 'O2优化', '矩阵加速', '期望']
---
# 「PFLOI R1」PFL 团主的 PFL 操作
## 题目背景

比赛结束后，智力、旸麦、花猫邀来碓瑘，四人从此结交为友。

--------------------

实际上，不光碓瑘，智力、旸麦、花猫都曾是 OI 界中最强的存在。一次又一次 AK 一场又一场 Trash Round 后，它们厌倦了，从此销声匿迹，退出江湖。

今天看到碓瑘才气不减当年，它们又念想起那些和 OI 作伴的时光……兴意，顿生心头。

于是它们找到了 PFLOI 团长珺珺，请求珺珺给它们再次辉煌的机会——出一场属于自己的比赛。

听完它们的事迹后，珺珺颇为感动，欣然同意。5 人就此相聚在 PFLOI。

但是旸麦进入 PFLOI 后~~乱出题~~太调皮了，珺珺可不乐意了，于是：

![](https://cdn.luogu.com.cn/upload/image_hosting/9m9343n9.png)

![](https://cdn.luogu.com.cn/upload/image_hosting/znp6x2ta.png)
## 题目描述

有 $n$ 次操作，每次操作会等概率地进行以下事件中的一个：

1. 将 $a_i$ 加入团队，操作后 $a_i$ 为成员。
2. 将 $a_i$ 踢出团队。
3. 将 $a_i$ 设置为管理员。
4. 将 $a_i$ 设置为成员。

**注意：**

+ 开始时没有人在团队里。  
+ 如果 $a_i$ 不在团队中，则 2、3、4 操作无效果。  
+ 如果 $a_i$ 为成员，则 1、4 操作无效果。  
+ 如果 $a_i$ 是管理员，则 1、2、3 操作无效果。  

最后输出团队中管理员个数的期望，答案对 $998244353$ 取模。
## 输入格式

第一行一个整数 $\text{type}$。  
如果 $\text{type}$ 为 $1$，则采用**第一种输入方式**，否则采用**第二种输入方式**。

### 第一种输入方式：

第一行一个正整数 $n$。  
第二行共 $n$ 个整数表示数组 $a$。

### 第二种输入方式：

共一行四个整数分别是 $n,a_0,p,q$。    

**注意：第二种输入方式中，数组 $a$ 需要你计算得出，满足 $a_i=(a_{i-1}\times p+p)\bmod q+ 1$ $ (i \geq 1)$。**
## 输出格式

输出一个整数表示团队中管理员个数的期望，对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
1
6
1 1 2 1 2 1

```
### 样例输出 #1
```
760381441
```
### 样例输入 #2
```
2
11 4 5 14
```
### 样例输出 #2
```
686292993
```
## 提示

**本题采用捆绑测试**。

| 子任务编号	 | $\text{type}=$ | $n$ | $a_i$ | 分值 |
| :---: | :---: | :---: | :---: | :---: |
| $1$ | $1$ | $n\le 100$ | $1\le a_i\le10$ | $25$ |
| $2$ | $1$ | $n\le 5\times 10^5$ | $1\le a_i\le 10^{18}$ | $35$ |

| 子任务编号	 | $\text{type}=$ | $n$ | $a_0,p,q$ | 分值 |
|:---------:|:------:|:---:|:-----:|:-----:|
| $3$ | $2$ | $n\le 10^6$ | $1\le a_0,p<q\le 20$ | $10$ |
| $4$ | $2$ | $n\le 10^{18}$ | $1\le a_0,p<q\le 3\times 10^5$ | $30$ |

对于所有数据，$1\le n\le 10^{18}$。
