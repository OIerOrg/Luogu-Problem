---
diff: NOI/NOI+/CTSC
pid: P10198
name: [USACO24FEB] Infinite Adventure P
tag: ['USACO', '2024', 'O2优化']
---
# [USACO24FEB] Infinite Adventure P
## 题目背景

**注意：本题的内存限制为 512MB，通常限制的 2 倍。**
## 题目描述

Bessie 正在计划一次在 $N$（$1\le N\le 10^5$）个城市的大陆上的无尽冒险。每个城市 $i$ 都有一个传送门以及循环周期 $T_i$。所有 $T_i$ 均为 $2$ 的幂，且 $T_1+\cdots+T_N\le 10^5$。如果你在日期 $t$ 进入城市 $i$ 的传送门，那么你会立即从城市 $c_{i,t\bmod T_i}$ 的传送门出来。

Bessie 的旅行有 $Q$（$1\le Q\le 5\cdot 10^4$）个计划，每个计划由一个元组 $(v,t,\Delta)$ 组成。在每个计划中，她将于日期 $t$ 从城市 $v$ 出发。然后，她将执行以下操作 $\Delta$ 次：她将进入当前城市的传送门，然后等待一天。对于她的每一个计划，她想要知道她最终会在哪个城市。
## 输入格式

输入的第一行包含两个空格分隔的整数：结点的数量 $N$，以及询问的数量 $Q$。

第二行包含 $N$ 个空格分隔的整数：$T_1,T_2,\ldots,T_N$（$1\le T_i$，$T_i$ 是 $2$ 的幂，且 $T_1+\cdots+T_N\le 10^5$）。

对于 $i=1,2,\ldots,N$，第 $i+2$ 行包含 $T_i$ 个空格分隔的正整数，为 $c_{i,0},\ldots,c_{i,T_{i−1}}$（$1\le c_i,t\le N$）。

对于 $j=1,2,…,Q$，第 $j+N+2$ 行包含三个空格分隔的正整数 $v_j,t_j,\Delta_j$（$1\le v_j\le N$，$1\le t_j\le 10^{18}$，且 $1\le \Delta_j\le 10^{18}$），表示第 $j$ 个询问。 
## 输出格式

输出 $Q$ 行。第 $j$ 行包含第 $j$ 个询问的答案。 
## 样例

### 样例输入 #1
```
5 4
1 2 1 2 8
2
3 4
4
2 3
5 5 5 5 5 1 5 5
2 4 3
3 3 6
5 3 2
5 3 7
```
### 样例输出 #1
```
2
2
5
4
```
### 样例输入 #2
```
5 5
1 2 1 2 8
2
3 4
4
2 3
5 5 5 5 5 1 5 5
2 4 3
3 2 6
5 3 2
5 3 7
5 3 1000000000000000000
```
### 样例输出 #2
```
2
3
5
4
2
```
## 提示

### 样例解释 1

Bessie 的前三次冒险会如下进行：

- 在第一次冒险中，她于时刻 $4$ 从城市 $2$ 出发，于时刻 $5$ 到达城市 $3$，于时刻 $6$ 到达城市 $4$，于时刻 $7$ 到达城市 $2$。
- 在第二次冒险中，她于时刻 $3$ 从城市 $3$ 出发，于时刻 $4$ 到达城市 $4$，于时刻 $5$ 到达城市 $2$，于时刻 $6$ 到达城市 $4$，于时刻 $7$ 到达城市 $2$，于时刻 $8$ 到达城市 $4$，于时刻 $9$ 到达城市 $2$。
- 在第三次冒险中，她于时刻 $3$ 从城市 $5$ 出发，于时刻 $4$ 到达城市 $5$，于时刻 $5$ 到达城市 $5$。

### 测试点性质

- 测试点 $3$：$\Delta_j\le 2\cdot 10^2$。
- 测试点 $4-5$：$N,\sum T_j\le 2\cdot 10^3$。
- 测试点 $6-8$：$N,\sum T_j\le 10^4$。
- 测试点 $9-18$：没有额外限制。
